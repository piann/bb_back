# Migration `20200729202624-init`

This migration has been generated by piann <shadow_hat@naver.com> at 7/29/2020, 8:26:24 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "Role" AS ENUM ('HACKER', 'BUSINESS', 'ADMIN');

CREATE TYPE "ReasonOfLock" AS ENUM ('NEW_ACCOUNT', 'TOO_MANY_TRIAL');

CREATE TYPE "TargetType" AS ENUM ('WEB', 'IOS', 'ANDROID');

CREATE TYPE "ResultCode" AS ENUM ('UNABLE_TO_JUDGE', 'DUPLICATED', 'NOT_VULNERABILITY', 'NOT_TARGET_BOUNTY', 'TARGET_BOUNTY');

CREATE TABLE "bb_schema"."User" (
"id" text  NOT NULL ,
"firstName" text  NOT NULL ,
"lastName" text  NOT NULL ,
"email" text  NOT NULL ,
"passwordHash" text  NOT NULL ,
"phoneNumber" text   ,
"isLocked" boolean  NOT NULL DEFAULT true,
"reasonOfLock" "ReasonOfLock"  ,
"numberOfLoginFail" integer  NOT NULL DEFAULT 0,
"note" text   ,
"role" "Role" NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."HackerInfo" (
"id" text  NOT NULL ,
"userId" text  NOT NULL ,
"credit" integer  NOT NULL DEFAULT 0,
"totalBounty" integer  NOT NULL DEFAULT 0,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."BusinessInfo" (
"id" text  NOT NULL ,
"userId" text  NOT NULL ,
"companyId" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."Company" (
"id" text  NOT NULL ,
"companyName" text  NOT NULL ,
"webPageUrl" text   ,
"logoId" text   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."BugBountyProgram" (
"id" text  NOT NULL ,
"ownerCompanyId" text  NOT NULL ,
"isPrivate" boolean  NOT NULL ,
"disclosurePolicy" text  NOT NULL ,
"closeDate" timestamp(3)   ,
"lowPriceMin" integer  NOT NULL ,
"lowPriceMax" integer  NOT NULL ,
"mediumPriceMin" integer  NOT NULL ,
"mediumriceMax" integer  NOT NULL ,
"highPriceMin" integer  NOT NULL ,
"highriceMax" integer  NOT NULL ,
"fatalPriceMin" integer  NOT NULL ,
"fatalPriceMax" integer  NOT NULL ,
"introduction" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."ProgramRule" (
"id" SERIAL,
"value" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."InScopeTarget" (
"id" SERIAL,
"type" "TargetType" NOT NULL ,
"value" text  NOT NULL ,
"programId" text  NOT NULL ,
"note" text   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."OutOfScopeTarget" (
"id" SERIAL,
"type" "TargetType" NOT NULL ,
"value" text  NOT NULL ,
"programId" text  NOT NULL ,
"note" text   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."BountyExclusion" (
"id" SERIAL,
"value" text  NOT NULL ,
"programId" text  NOT NULL ,
"note" text   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."ReportTip" (
"id" SERIAL,
"value" text  NOT NULL ,
"note" text   ,
"bbpId" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."FileObj" (
"id" text  NOT NULL ,
"isPublic" boolean  NOT NULL ,
"fileName" text  NOT NULL ,
"fileType" text   ,
"rawData" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."Report" (
"id" text  NOT NULL ,
"bbpId" text  NOT NULL ,
"authorId" text  NOT NULL ,
"vulId" integer  NOT NULL ,
"attackComplexity" integer   ,
"requiredPriv" integer   ,
"userInteraction" integer   ,
"confidentiality" integer   ,
"integrity" integer   ,
"availablity" integer   ,
"title" text   ,
"location" text   ,
"enviroment" text   ,
"description" text  NOT NULL ,
"dump" text   ,
"additionalText" text   ,
"fileId" text   ,
"bountyAmount" integer  NOT NULL DEFAULT 0,
"evaluationText" text   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."Vulnerability" (
"id" SERIAL,
"category" text  NOT NULL ,
"name" text  NOT NULL ,
"note" text   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."ProgressStatus" (
"id" text  NOT NULL ,
"progressIdx" integer  NOT NULL DEFAULT 0,
"reportId" text  NOT NULL ,
"note" text   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."ReportResult" (
"id" text  NOT NULL ,
"resultCode" "ResultCode" NOT NULL ,
"reportId" text  NOT NULL ,
"note" text   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."ReportComment" (
"id" text  NOT NULL ,
"reportId" text  NOT NULL ,
"fileId" text   ,
"note" text   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."_FileObjToUser" (
"A" text  NOT NULL ,
"B" text  NOT NULL )

CREATE TABLE "bb_schema"."_BugBountyProgramToProgramRule" (
"A" text  NOT NULL ,
"B" integer  NOT NULL )

CREATE TABLE "bb_schema"."_InScopeTargetToReport" (
"A" integer  NOT NULL ,
"B" text  NOT NULL )

CREATE UNIQUE INDEX "User.email" ON "bb_schema"."User"("email")

CREATE UNIQUE INDEX "HackerInfo_userId" ON "bb_schema"."HackerInfo"("userId")

CREATE UNIQUE INDEX "BusinessInfo_userId" ON "bb_schema"."BusinessInfo"("userId")

CREATE UNIQUE INDEX "Company.companyName" ON "bb_schema"."Company"("companyName")

CREATE UNIQUE INDEX "_FileObjToUser_AB_unique" ON "bb_schema"."_FileObjToUser"("A","B")

CREATE  INDEX "_FileObjToUser_B_index" ON "bb_schema"."_FileObjToUser"("B")

CREATE UNIQUE INDEX "_BugBountyProgramToProgramRule_AB_unique" ON "bb_schema"."_BugBountyProgramToProgramRule"("A","B")

CREATE  INDEX "_BugBountyProgramToProgramRule_B_index" ON "bb_schema"."_BugBountyProgramToProgramRule"("B")

CREATE UNIQUE INDEX "_InScopeTargetToReport_AB_unique" ON "bb_schema"."_InScopeTargetToReport"("A","B")

CREATE  INDEX "_InScopeTargetToReport_B_index" ON "bb_schema"."_InScopeTargetToReport"("B")

ALTER TABLE "bb_schema"."HackerInfo" ADD FOREIGN KEY ("userId")REFERENCES "bb_schema"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."BusinessInfo" ADD FOREIGN KEY ("userId")REFERENCES "bb_schema"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."BusinessInfo" ADD FOREIGN KEY ("companyId")REFERENCES "bb_schema"."Company"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."Company" ADD FOREIGN KEY ("logoId")REFERENCES "bb_schema"."FileObj"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "bb_schema"."BugBountyProgram" ADD FOREIGN KEY ("ownerCompanyId")REFERENCES "bb_schema"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."InScopeTarget" ADD FOREIGN KEY ("programId")REFERENCES "bb_schema"."BugBountyProgram"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."OutOfScopeTarget" ADD FOREIGN KEY ("programId")REFERENCES "bb_schema"."BugBountyProgram"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."BountyExclusion" ADD FOREIGN KEY ("programId")REFERENCES "bb_schema"."BugBountyProgram"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."ReportTip" ADD FOREIGN KEY ("bbpId")REFERENCES "bb_schema"."BugBountyProgram"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."Report" ADD FOREIGN KEY ("bbpId")REFERENCES "bb_schema"."BugBountyProgram"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."Report" ADD FOREIGN KEY ("authorId")REFERENCES "bb_schema"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."Report" ADD FOREIGN KEY ("vulId")REFERENCES "bb_schema"."Vulnerability"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."Report" ADD FOREIGN KEY ("fileId")REFERENCES "bb_schema"."FileObj"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "bb_schema"."ProgressStatus" ADD FOREIGN KEY ("reportId")REFERENCES "bb_schema"."Report"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."ReportResult" ADD FOREIGN KEY ("reportId")REFERENCES "bb_schema"."Report"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."ReportComment" ADD FOREIGN KEY ("reportId")REFERENCES "bb_schema"."Report"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."ReportComment" ADD FOREIGN KEY ("fileId")REFERENCES "bb_schema"."FileObj"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "bb_schema"."_FileObjToUser" ADD FOREIGN KEY ("A")REFERENCES "bb_schema"."FileObj"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."_FileObjToUser" ADD FOREIGN KEY ("B")REFERENCES "bb_schema"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."_BugBountyProgramToProgramRule" ADD FOREIGN KEY ("A")REFERENCES "bb_schema"."BugBountyProgram"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."_BugBountyProgramToProgramRule" ADD FOREIGN KEY ("B")REFERENCES "bb_schema"."ProgramRule"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."_InScopeTargetToReport" ADD FOREIGN KEY ("A")REFERENCES "bb_schema"."InScopeTarget"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."_InScopeTargetToReport" ADD FOREIGN KEY ("B")REFERENCES "bb_schema"."Report"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200729153209-init..20200729202624-init
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -169,9 +169,9 @@
   id String @id @default(cuid())
   isPublic Boolean
   permittedUserList User[] @relation(references: [id])
   fileName String
-  mimeType String?
+  fileType String?
   rawData String
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt @default(now())
 }
```


