# Migration `20200728164837-init`

This migration has been generated by piann <shadow_hat@naver.com> at 7/28/2020, 4:48:37 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TYPE "ResultCode" ADD VALUE 'NOT_TARGET_BOUNTY';
ALTER TYPE "ResultCode" ADD VALUE 'TARGET_BOUNTY'

CREATE TABLE "bb_schema"."ProgressStatus" (
"id" text  NOT NULL ,
"progressIdx" integer  NOT NULL DEFAULT 0,
"reportId" text  NOT NULL ,
"note" text   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."Comment" (
"id" text  NOT NULL ,
"reportId" text  NOT NULL ,
"note" text   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."_InScopeTargetToReport" (
"A" integer  NOT NULL ,
"B" text  NOT NULL )

ALTER TABLE "bb_schema"."Report" ADD COLUMN "resultCode" "ResultCode"  ;

CREATE UNIQUE INDEX "_InScopeTargetToReport_AB_unique" ON "bb_schema"."_InScopeTargetToReport"("A","B")

CREATE  INDEX "_InScopeTargetToReport_B_index" ON "bb_schema"."_InScopeTargetToReport"("B")

ALTER TABLE "bb_schema"."ProgressStatus" ADD FOREIGN KEY ("reportId")REFERENCES "bb_schema"."Report"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."Comment" ADD FOREIGN KEY ("reportId")REFERENCES "bb_schema"."Report"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."_InScopeTargetToReport" ADD FOREIGN KEY ("A")REFERENCES "bb_schema"."InScopeTarget"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."_InScopeTargetToReport" ADD FOREIGN KEY ("B")REFERENCES "bb_schema"."Report"("id") ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE "bb_schema"."ProgressThread";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200728152656-init..20200728164837-init
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -31,9 +31,10 @@
 enum ResultCode{
   UNABLE_TO_JUDGE
   DUPLICATED
   NOT_VULNERABILITY
-
+  NOT_TARGET_BOUNTY
+  TARGET_BOUNTY
 }
 model User{
     id String @id @default(cuid())
@@ -111,8 +112,9 @@
   programId String
   note String?
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt @default(now())
+  reports Report[] @relation(references:[id])
 }
 model OutOfScopeTarget{
   id Int @id @default(autoincrement())
@@ -147,8 +149,9 @@
 model Report{
   id String @id @default(cuid())
   vulnerability Vulnerability @relation(fields: [vulId], references:[id])
   vulId Int
+  target InScopeTarget[] @relation(references:[id])
   // for impact scoring
   attackComplexity Int?
   requiredPriv Int?
   userInteraction Int?
@@ -161,13 +164,15 @@
   enviroment String?
   description String
   dump String?
   additionalText String?
-  //progressStatus
-  //resultCode 
+  progressStatus ProgressStatus[]
+  resultCode ResultCode?
   evaluationText String?
+  commentList Comment[]
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt @default(now())
+  //
 }
 model Vulnerability{
   id Int @id @default(autoincrement())
@@ -188,10 +193,22 @@
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt @default(now())
 }
-model ProgressThread{
+model ProgressStatus{
   id String @id @default(cuid())
+  progressIdx Int @default(value:0)
+  report Report @relation(fields: [reportId],references: [id])
+  reportId String
+  note String?
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt @default(now())
+}
+model Comment{
+  id String @id @default(cuid())
+  report Report @relation(fields: [reportId], references: [id])
+  reportId String
+  note String?
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt @default(now())
-}
+}
```


