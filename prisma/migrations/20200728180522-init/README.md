# Migration `20200728180522-init`

This migration has been generated by piann <shadow_hat@naver.com> at 7/28/2020, 6:05:22 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "bb_schema"."BountyExclusion" DROP COLUMN "type";

ALTER TABLE "bb_schema"."BugBountyProgram" ADD COLUMN "ownerId" text  NOT NULL ;

ALTER TABLE "bb_schema"."Comment" ADD COLUMN "fileId" text   ;

ALTER TABLE "bb_schema"."Report" ADD COLUMN "bbpId" text  NOT NULL ,
ADD COLUMN "authorId" text  NOT NULL ,
ADD COLUMN "fileId" text   ;

ALTER TABLE "bb_schema"."ReportTip" ADD COLUMN "bbpId" text  NOT NULL ;

CREATE UNIQUE INDEX "BusinessInfo.companyName" ON "bb_schema"."BusinessInfo"("companyName")

ALTER TABLE "bb_schema"."BugBountyProgram" ADD FOREIGN KEY ("ownerId")REFERENCES "bb_schema"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."Comment" ADD FOREIGN KEY ("fileId")REFERENCES "bb_schema"."FileObj"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "bb_schema"."Report" ADD FOREIGN KEY ("bbpId")REFERENCES "bb_schema"."BugBountyProgram"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."Report" ADD FOREIGN KEY ("authorId")REFERENCES "bb_schema"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."Report" ADD FOREIGN KEY ("fileId")REFERENCES "bb_schema"."FileObj"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "bb_schema"."ReportTip" ADD FOREIGN KEY ("bbpId")REFERENCES "bb_schema"."BugBountyProgram"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200728164837-init..20200728180522-init
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -54,9 +54,9 @@
     updatedAt DateTime @updatedAt @default(now())
     // foreigner key
     owningFileList FileObj[] @relation(references: [id])
-    
+    reportList Report[]
 }
 model HackerInfo{
   id String @id @default(cuid())
@@ -71,16 +71,18 @@
 model BusinessInfo{
   id String @id @default(cuid())
   user User @relation(fields: [userId], references: [id])
   userId String
-  companyName String
+  companyName String @unique
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt @default(now())
 }
 model BugBountyProgram{
   id String @id @default(cuid())
+  owner User @relation(fields: [ownerId], references: [id])
+  ownerId String
   lowPriceMin Int
   lowPriceMax Int
   mediumPriceMin Int
   mediumriceMax Int
@@ -91,10 +93,13 @@
   introduction String
   programRuleList ProgramRule[] @relation(references:[id])
   inScopeList InScopeTarget[]
   outOfScopeList OutOfScopeTarget[]
+  exclusionList BountyExclusion[]
+  reportTipList ReportTip[]
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt @default(now())
+  reportList Report[]
 }
 model ProgramRule{
   id Int @id @default(autoincrement())
@@ -128,9 +133,8 @@
 }
 model BountyExclusion{
   id Int @id @default(autoincrement())
-  type TargetType
   value String
   bugBountyProgram BugBountyProgram @relation(fields: [programId], references: [id])
   programId String
   note String?
@@ -141,14 +145,20 @@
 model ReportTip{
   id Int @id @default(autoincrement())
   value String
   note String?
+  bugBountyProgram BugBountyProgram @relation(fields: [bbpId], references:[id])
+  bbpId String
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt @default(now())
 }
 model Report{
   id String @id @default(cuid())
+  bugBountyProgram BugBountyProgram @relation(fields: [bbpId], references:[id])
+  bbpId String
+  author User @relation(fields: [authorId], references:[id])
+  authorId String
   vulnerability Vulnerability @relation(fields: [vulId], references:[id])
   vulId Int
   target InScopeTarget[] @relation(references:[id])
   // for impact scoring
@@ -164,8 +174,10 @@
   enviroment String?
   description String
   dump String?
   additionalText String?
+  reportFile FileObj? @relation(fields: [fileId], references:[id])
+  fileId String?
   progressStatus ProgressStatus[]
   resultCode ResultCode?
   evaluationText String?
   commentList Comment[]
@@ -207,8 +219,10 @@
 model Comment{
   id String @id @default(cuid())
   report Report @relation(fields: [reportId], references: [id])
   reportId String
+  file FileObj? @relation(fields: [fileId], references: [id])
+  fileId String?
   note String?
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt @default(now())
 }
```


