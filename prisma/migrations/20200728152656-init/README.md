# Migration `20200728152656-init`

This migration has been generated by piann <shadow_hat@naver.com> at 7/28/2020, 3:26:56 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "Role" AS ENUM ('HACKER', 'BUSINESS', 'ADMIN');

CREATE TYPE "ReasonOfLock" AS ENUM ('NEW_ACCOUNT', 'TOO_MANY_TRIAL');

CREATE TYPE "TargetType" AS ENUM ('WEB', 'IOS', 'ANDROID');

CREATE TYPE "ResultCode" AS ENUM ('UNABLE_TO_JUDGE', 'DUPLICATED', 'NOT_VULNERABILITY');

CREATE TABLE "bb_schema"."User" (
"id" text  NOT NULL ,
"firstName" text  NOT NULL ,
"lastName" text  NOT NULL ,
"email" text  NOT NULL ,
"passwordHash" text  NOT NULL ,
"phoneNumber" text   ,
"isLocked" boolean  NOT NULL DEFAULT true,
"reasonOfLock" "ReasonOfLock"  ,
"numberOfLoginFail" integer  NOT NULL DEFAULT 0,
"note" text   ,
"role" "Role" NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."HackerInfo" (
"id" text  NOT NULL ,
"userId" text  NOT NULL ,
"credit" integer  NOT NULL DEFAULT 0,
"totalBounty" integer  NOT NULL DEFAULT 0,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."BusinessInfo" (
"id" text  NOT NULL ,
"userId" text  NOT NULL ,
"companyName" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."BugBountyProgram" (
"id" text  NOT NULL ,
"lowPriceMin" integer  NOT NULL ,
"lowPriceMax" integer  NOT NULL ,
"mediumPriceMin" integer  NOT NULL ,
"mediumriceMax" integer  NOT NULL ,
"highPriceMin" integer  NOT NULL ,
"highriceMax" integer  NOT NULL ,
"fatalPriceMin" integer  NOT NULL ,
"fatalPriceMax" integer  NOT NULL ,
"introduction" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."ProgramRule" (
"id" SERIAL,
"value" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."InScopeTarget" (
"id" SERIAL,
"type" "TargetType" NOT NULL ,
"value" text  NOT NULL ,
"programId" text  NOT NULL ,
"note" text   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."OutOfScopeTarget" (
"id" SERIAL,
"type" "TargetType" NOT NULL ,
"value" text  NOT NULL ,
"programId" text  NOT NULL ,
"note" text   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."BountyExclusion" (
"id" SERIAL,
"type" "TargetType" NOT NULL ,
"value" text  NOT NULL ,
"programId" text  NOT NULL ,
"note" text   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."ReportTip" (
"id" SERIAL,
"value" text  NOT NULL ,
"note" text   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."Report" (
"id" text  NOT NULL ,
"vulId" integer  NOT NULL ,
"attackComplexity" integer   ,
"requiredPriv" integer   ,
"userInteraction" integer   ,
"confidentiality" integer   ,
"integrity" integer   ,
"availablity" integer   ,
"title" text   ,
"location" text   ,
"enviroment" text   ,
"description" text  NOT NULL ,
"dump" text   ,
"additionalText" text   ,
"evaluationText" text   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."Vulnerability" (
"id" SERIAL,
"category" text  NOT NULL ,
"name" text  NOT NULL ,
"note" text   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."FileObj" (
"id" text  NOT NULL ,
"isPublic" boolean  NOT NULL ,
"fileName" text  NOT NULL ,
"mimetype" text   ,
"rawData" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."ProgressThread" (
"id" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "bb_schema"."_FileObjToUser" (
"A" text  NOT NULL ,
"B" text  NOT NULL )

CREATE TABLE "bb_schema"."_BugBountyProgramToProgramRule" (
"A" text  NOT NULL ,
"B" integer  NOT NULL )

CREATE UNIQUE INDEX "User.email" ON "bb_schema"."User"("email")

CREATE UNIQUE INDEX "HackerInfo_userId" ON "bb_schema"."HackerInfo"("userId")

CREATE UNIQUE INDEX "BusinessInfo_userId" ON "bb_schema"."BusinessInfo"("userId")

CREATE UNIQUE INDEX "_FileObjToUser_AB_unique" ON "bb_schema"."_FileObjToUser"("A","B")

CREATE  INDEX "_FileObjToUser_B_index" ON "bb_schema"."_FileObjToUser"("B")

CREATE UNIQUE INDEX "_BugBountyProgramToProgramRule_AB_unique" ON "bb_schema"."_BugBountyProgramToProgramRule"("A","B")

CREATE  INDEX "_BugBountyProgramToProgramRule_B_index" ON "bb_schema"."_BugBountyProgramToProgramRule"("B")

ALTER TABLE "bb_schema"."HackerInfo" ADD FOREIGN KEY ("userId")REFERENCES "bb_schema"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."BusinessInfo" ADD FOREIGN KEY ("userId")REFERENCES "bb_schema"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."InScopeTarget" ADD FOREIGN KEY ("programId")REFERENCES "bb_schema"."BugBountyProgram"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."OutOfScopeTarget" ADD FOREIGN KEY ("programId")REFERENCES "bb_schema"."BugBountyProgram"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."BountyExclusion" ADD FOREIGN KEY ("programId")REFERENCES "bb_schema"."BugBountyProgram"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."Report" ADD FOREIGN KEY ("vulId")REFERENCES "bb_schema"."Vulnerability"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."_FileObjToUser" ADD FOREIGN KEY ("A")REFERENCES "bb_schema"."FileObj"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."_FileObjToUser" ADD FOREIGN KEY ("B")REFERENCES "bb_schema"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."_BugBountyProgramToProgramRule" ADD FOREIGN KEY ("A")REFERENCES "bb_schema"."BugBountyProgram"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "bb_schema"."_BugBountyProgramToProgramRule" ADD FOREIGN KEY ("B")REFERENCES "bb_schema"."ProgramRule"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200728101250-init..20200728152656-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,10 +1,10 @@
 // This is your Prisma schema file,
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
-  provider = "mysql"
-  url = "***"
+  provider = "postgresql"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -21,8 +21,21 @@
   NEW_ACCOUNT
   TOO_MANY_TRIAL
 }
+enum TargetType{
+  WEB
+  IOS
+  ANDROID
+}
+
+enum ResultCode{
+  UNABLE_TO_JUDGE
+  DUPLICATED
+  NOT_VULNERABILITY
+
+}
+
 model User{
     id String @id @default(cuid())
     firstName String
     lastName String
@@ -37,16 +50,20 @@
     hackerInfo HackerInfo?
     businessInfo BusinessInfo?
     createdAt DateTime @default(now())
     updatedAt DateTime @updatedAt @default(now())
+
+    // foreigner key
+    owningFileList FileObj[] @relation(references: [id])
 }
 model HackerInfo{
   id String @id @default(cuid())
   user User @relation(fields: [userId], references: [id])
   userId String
-  
+  credit Int @default(value:0)
+  totalBounty Int @default(value:0)
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt @default(now())
 }
@@ -56,5 +73,125 @@
   userId String
   companyName String
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt @default(now())
-}
+}
+
+
+model BugBountyProgram{
+  id String @id @default(cuid())
+  lowPriceMin Int
+  lowPriceMax Int
+  mediumPriceMin Int
+  mediumriceMax Int
+  highPriceMin Int
+  highriceMax Int
+  fatalPriceMin Int
+  fatalPriceMax Int
+  introduction String
+  programRuleList ProgramRule[] @relation(references:[id])
+  inScopeList InScopeTarget[]
+  outOfScopeList OutOfScopeTarget[]
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt @default(now())
+}
+
+model ProgramRule{
+  id Int @id @default(autoincrement())
+  value String
+  bugBountyProgramList BugBountyProgram[] @relation(references:[id])
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt @default(now())
+}
+
+model InScopeTarget{
+  id Int @id @default(autoincrement())
+  type TargetType
+  value String
+  bugBountyProgram BugBountyProgram @relation(fields: [programId], references: [id])
+  programId String
+  note String?
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt @default(now())
+}
+
+model OutOfScopeTarget{
+  id Int @id @default(autoincrement())
+  type TargetType
+  value String
+  bugBountyProgram BugBountyProgram @relation(fields: [programId], references: [id])
+  programId String
+  note String?
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt @default(now())
+}
+
+model BountyExclusion{
+  id Int @id @default(autoincrement())
+  type TargetType
+  value String
+  bugBountyProgram BugBountyProgram @relation(fields: [programId], references: [id])
+  programId String
+  note String?
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt @default(now())
+}
+
+model ReportTip{
+  id Int @id @default(autoincrement())
+  value String
+  note String?
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt @default(now())
+}
+
+model Report{
+  id String @id @default(cuid())
+  vulnerability Vulnerability @relation(fields: [vulId], references:[id])
+  vulId Int
+  // for impact scoring
+  attackComplexity Int?
+  requiredPriv Int?
+  userInteraction Int?
+  confidentiality Int?
+  integrity Int?
+  availablity Int?
+  // report content
+  title String?
+  location String?
+  enviroment String?
+  description String
+  dump String?
+  additionalText String?
+  //progressStatus
+  //resultCode 
+  evaluationText String?
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt @default(now())
+}
+
+model Vulnerability{
+  id Int @id @default(autoincrement())
+  category String
+  name String
+  note String?
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt @default(now())
+}
+
+model FileObj{
+  id String @id @default(cuid())
+  isPublic Boolean
+  permittedUserList User[] @relation(references: [id])
+  fileName String
+  mimetype String?
+  rawData String
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt @default(now())
+}
+
+model ProgressThread{
+  id String @id @default(cuid())
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt @default(now())
+}
```


